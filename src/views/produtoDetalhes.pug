//- produtoDetalhes.pug
doctype html
html(lang="pt-br")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= produto.nome
    link(rel="stylesheet", href="/css/style.css")
    style.
      .produto-detalhes-container {
        background-color: #b7410e;
        padding: 20px;
        border-radius: 10px;
        max-width: 1000px;
        margin: 0 auto;
        color: #fff;
      }
      .produto-layout {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        align-items: flex-start;
      }
      .carousel {
        flex: 1;
        max-width: 400px;
        position: relative;
      }
      .carousel img {
        width: 100%;
        height: 350px;
        object-fit: cover;
        border-radius: 10px;
        display: none;
      }
      .carousel img.active {
        display: block;
      }
      .carousel-controls {
        text-align: center;
        margin-top: 10px;
      }
      .carousel-controls button {
        background: #fff;
        color: #b7410e;
        border: none;
        padding: 5px 12px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
      }
      .produto-info {
        flex: 1;
        min-width: 250px;
      }
      .produto-acoes {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 20px;
      }

  body
    // Botão Voltar
    a(href="/", style="display: inline-block; margin: 20px;")
      button(style="background-color: #b7410e; color: #fff; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;") Voltar

    main
      .produto-detalhes-container
        .produto-layout
          // ✅ Carousel de imagens
          if produto.imagens
            - const imagens = JSON.parse(produto.imagens);
            if imagens.length
              .carousel
                each imgSrc, index in imagens
                  img(src='/' + imgSrc, alt=produto.nome + " " + (index + 1), class=(index === 0 ? "active" : ""))
                .carousel-controls
                  button(type="button", onclick="prevImg()") ◀
                  button(type="button", onclick="nextImg()") ▶

          // ✅ Informações do produto
          .produto-info
            h1(style="margin-bottom: 10px;")= produto.nome
            p.preco R$ #{produto.preco.toFixed(2)}
            if produto.desconto > 0
              p.desconto Desconto: #{produto.desconto} %
            if produto.Categoria
              p Categoria: #{produto.Categoria.nome}
            p Tamanho: #{produto.tamanho}
            p Descrição: #{produto.descricao}

            // Botões de ação
            .produto-acoes
              form(action="/carrinho/adicionar/" + produto.id, method="post")
                button(type="submit", class="btn-carrinho", style="background-color: #fff; color: #b7410e; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;") Adicionar ao Carrinho

              if usuario && usuario.tipo === 'admin'
                form(action="/produtos/" + produto.id + "/deletar", method="post")
                  button(type="submit", class="btn-deletar", style="background-color: #fff; color: red; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;") Excluir Produto
                a(href="/produtos/" + produto.id + "/editar")
                  button(class="btn-editar", style="background-color: #fff; color: #000; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;") Editar Produto

    script.
      let currentIndex = 0;
      const imgs = document.querySelectorAll('.carousel img');

      function showImg(index) {
        imgs.forEach((img, i) => {
          img.classList.toggle('active', i === index);
        });
      }

      function prevImg() {
        currentIndex = (currentIndex - 1 + imgs.length) % imgs.length;
        showImg(currentIndex);
      }

      function nextImg() {
        currentIndex = (currentIndex + 1) % imgs.length;
        showImg(currentIndex);
      }
