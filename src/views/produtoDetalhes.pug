//- produtoDetalhes.pug
doctype html
html(lang="pt-br")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= produto.nome
    link(rel="stylesheet", href="/css/style.css")
    style.
      .produto-detalhes-container {
        background-color: #b7410e;
        padding: 20px;
        border-radius: 10px;
        max-width: 1000px;
        margin: 0 auto;
        color: #fff;
      }
      .produto-layout {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        align-items: flex-start;
      }
      .carousel {
        flex: 1;
        max-width: 400px;
        position: relative;
      }
      .carousel img {
        width: 100%;
        height: 350px;
        object-fit: contain; /* Mantém proporção da imagem, não corta */
        display: none;
      }
      .carousel img.active {
        display: block;
      }
      .carousel-controls {
        text-align: center;
        margin-top: 10px;
      }
      .carousel-controls button {
        background: #fff;
        color: #b7410e;
        border: none;
        padding: 5px 12px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
      }
      .produto-info {
        flex: 1;
        min-width: 250px;
      }

  body
    // Botão Voltar
    a(href="/", style="display: inline-block; margin: 20px;")
      button(style="background-color: #b7410e; color: #fff; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;") Voltar

    main
      .produto-detalhes-container
        .produto-layout
          // ✅ Carousel de imagens
          - const imagens = produto.imagens ? JSON.parse(produto.imagens) : [];
          if imagens.length
            .carousel
              each imgSrc, index in imagens
                img(src=imgSrc, alt=produto.nome + " " + (index + 1), class=(index === 0 ? "active" : ""))
              .carousel-controls
                button(type="button", onclick="prevImg()") ◀
                button(type="button", onclick="nextImg()") ▶
          else
            img(src="/img/placeholder.png", alt="Sem imagem")

          // ✅ Informações do produto
          .produto-info
            h1(style="margin-bottom: 10px;")= produto.nome
            p.preco R$ #{produto.preco.toFixed(2)}
            if produto.desconto > 0
              p.desconto Desconto: #{produto.desconto} %
            if produto.Categoria
              p Categoria: #{produto.Categoria.nome}
            p Tamanho: #{produto.tamanho}
            p Descrição: #{produto.descricao}

            // Botões de ação
            .produto-acoes
              if usuario
                form(action="/carrinho/adicionar/" + produto.id, method="post")
                  button(type="submit", class="btn-carrinho") Adicionar ao Carrinho
              else
                a(href="/login")
                  button(type="button", class="btn-carrinho") Adicionar ao Carrinho

              if usuario && usuario.tipo === 'admin'
                form(action="/produtos/" + produto.id + "/deletar", method="post")
                  button(type="submit", class="btn-deletar") Excluir Produto
                a(href="/produtos/" + produto.id + "/editar")
                  button(class="btn-editar") Editar Produto

    script.
      let currentIndex = 0;
      const imgs = document.querySelectorAll('.carousel img');

      function showImg(index) {
        imgs.forEach((img, i) => {
          img.classList.toggle('active', i === index);
        });
      }

      function prevImg() {
        if (imgs.length === 0) return;
        currentIndex = (currentIndex - 1 + imgs.length) % imgs.length;
        showImg(currentIndex);
      }

      function nextImg() {
        if (imgs.length === 0) return;
        currentIndex = (currentIndex + 1) % imgs.length;
        showImg(currentIndex);
      }
