doctype html
html(lang="pt-br")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Heranças do Sul
    link(rel="stylesheet", href="/css/style.css")

  body
    header
      .header-content
        img(src="/img/logo.png", alt="Logo Heranças do Sul", class="logo-header")
        .search-bar
          input#searchInput(type="text", placeholder="Pesquisar produtos...")
        nav.header-nav
          a(href="/carrinho")
            button Carrinho

          if !usuario || !usuario.usuarioId || !usuario.tipo
            a(href="/login")
              button Entrar
            a(href="/usuarios/novo")
              button Cadastrar-se
          else
            if usuario.tipo === 'admin'
              a(href="/categorias/nova")
                button Cadastrar Categoria
              a(href="/produtos/novo")
                button Cadastrar Produto
              a(href="/perfil-admin")
                button.perfil-btn
                  if usuario.fotoPerfil
                    img(src=usuario.fotoPerfil, alt="Perfil", class="perfil-icon")
                  else
                    img(src="/img/user.png", alt="Perfil", class="perfil-icon")
            else
              a(href="/perfil")
                button.perfil-btn
                  if usuario.fotoPerfil
                    img(src=usuario.fotoPerfil, alt="Perfil", class="perfil-icon")
                  else
                    img(src="/img/user.png", alt="Perfil", class="perfil-icon")

    nav.main-nav
      .dropdown
        button.dropbtn Categorias
        .dropdown-content
          each cat in categorias
            a(href="/produtos/categoria/#{cat.id}")= cat.nome

      a(href="/produtos/novidades")
        button Novidades
      a(href="/produtos/descontos")
        button Descontos
      a(href="/produtos/populares")
        button Populares

    main
      if mensagemSucesso
        .alert-success= mensagemSucesso

      //- Grid de produtos
      .produtos-grid#produtosGrid
        each produto in produtos
          a.produto-card(href="/produtos/" + produto.id, data-nome=produto.nome.toLowerCase())
            img(src=produto.imagens && JSON.parse(produto.imagens)[0] || '/img/placeholder.png', alt=produto.nome)
            h3= produto.nome
            p.preco R$ #{produto.preco.toFixed(2)}
            if produto.desconto > 0
              p.desconto Desconto: #{produto.desconto} %

      // Mensagem caso não encontre produtos
      p#noResults(style="display:none; text-align:center; margin-top:20px; font-size:1.2rem; color:#b7410e;")
        | Nenhum Produto Encontrado

    .footer-bar
      | 48 98868-6376

    script.
      const searchInput = document.getElementById("searchInput");
      const produtosGrid = document.getElementById("produtosGrid");
      const noResults = document.getElementById("noResults");
      const produtos = produtosGrid ? produtosGrid.getElementsByClassName("produto-card") : [];

      if (searchInput) {
        searchInput.addEventListener("input", function() {
          const searchTerm = this.value.toLowerCase().trim();
          let found = false;

          Array.from(produtos).forEach(produto => {
            const nome = produto.getAttribute("data-nome");
            if (nome.includes(searchTerm)) {
              produto.style.display = "block";
              found = true;
            } else {
              produto.style.display = "none";
            }
          });

          if (!found && searchTerm !== "") {
            noResults.style.display = "block";
          } else {
            noResults.style.display = "none";
          }
        });
      }
